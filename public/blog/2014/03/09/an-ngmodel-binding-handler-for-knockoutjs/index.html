
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Lazy Model: An ngModel-ish binding handler for KnockoutJS - Coding in the basement</title>
	<meta name="author" content="Charles King">

	
	<meta name="description" content="After spending some time building my first production Angular app (which is great), the ngModel directive struck me as being immediately useful, &hellip;">
	

	<link href="/atom.xml" rel="alternate" title="Coding in the basement" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
	<meta name="viewport" content="width=device-width, user-scalable=no">

</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Coding in the basement</a></h1>
<nav class="menu"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/me">Me</a></li>
</ul>
</nav>

<div class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/112523142119059401568" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/thebringking" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/bringking" title="GitHub">GitHub</a>
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input  placeholder="Search" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:charlesbking.com">
	</form>
</div>

</header>
	
	<div id="content" class="inner"><article class="post">
	<h1 class="title">Lazy Model: An ngModel-ish Binding Handler for KnockoutJS</h1>
	<div class="entry-content"><p>After spending some time building my first production Angular app (which is great), the  <strong><a href="http://docs.angularjs.org/api/ng/directive/ngModel">ngModel</a></strong> directive struck me as being immediately useful, compared to the traditional KnockoutJS workflow. So I replicated some of the behavior with a &ldquo;lazy model&rdquo; binding handler.</p>

<!-- more -->


<h2>ngModel</h2>

<p>The part that I found particuarly useful with ngModel is that it <strong>creates</strong> and exposes the model property to the UI for binding. Therefore, you can describe an observable model object that doesn&rsquo;t exist yet, and it will be created for you.</p>

<figure class='code'><figcaption><span>Angular ngModel-html </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html+lasso'><span class='line'> <span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;Ctrl&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">&quot;name&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;my-input&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'> <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Angular ngModel-code </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">Ctrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//nothing here, but the name variable is created on the controllers $scope </span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Knockout</h2>

<p>Comparing this to knockout, you can see that you have to do a little more work to achieve the same result.</p>

<figure class='code'><figcaption><span>Knockout BasicVm-html </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html+lasso'><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value: name&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Knockout BasicVM-code </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span>  <span class="p">{</span>
</span><span class='line'>  <span class="nx">name</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindings</span><span class="p">(</span><span class="nx">vm</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>My main problem with the Knockout way, is that I have to describe my bindable model object in two places now, the view and the Viewmodel. To bring a little simplification to this process, I created a new binding handler to handle the implicit creation for me.</p>

<h2>Lazy Model</h2>

<figure class='code'><figcaption><span>Knockout Lazy-Model html </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html+lasso'><span class='line'><span class="c">&lt;!-- ko model: {value:&#39;name&#39;,target:model} --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value: model.name&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="c">&lt;!-- /ko --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- ko model: {value:&#39;address&#39;,target:model} --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value: model.address&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="c">&lt;!-- /ko --&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Knockout Lazy-Model code </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span>  <span class="p">{</span>
</span><span class='line'>  <span class="nx">model</span><span class="o">:</span><span class="p">{}</span> <span class="c1">//empty model that view objects get lazily added to</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this example, you can think of the <strong>model</strong> object as being our <strong>$scope</strong>. Whenever you declare an observable to bind in the UI, it will get implicty created onto the model object as an observable value. In this way, you have only described your model properties in one place. An added bonus is a really clean viewmodel.</p>

<p>The best part about this particular implementation, is that is can even get complex, with property path syntax, e.g.</p>

<figure class='code'><figcaption><span>Knockout Lazy-Model html </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html+lasso'><span class='line'><span class="c">&lt;!-- ko model: {value:&#39;name&#39;,target:model} --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value: model.name&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="c">&lt;!-- /ko --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- ko model: {value:&#39;address.city&#39;,target:model} --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value: model.address.city&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="c">&lt;!-- /ko --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- ko model: {value:&#39;address.zip&#39;,target:model} --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value: model.address.zip&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="c">&lt;!-- /ko --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This would result in an object that on the viewmodel that looks like &ndash;</p>

<figure class='code'><figcaption><span>Resultant lazily created object </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">model</span><span class="o">:</span><span class="p">{</span>
</span><span class='line'>  <span class="nx">name</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(),</span>
</span><span class='line'>  <span class="nx">address</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">city</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(),</span>
</span><span class='line'>      <span class="nx">zip</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> What are the drawbacks with a pattern like this? This is most useful for simple form controls where you don&rsquo;t need to access advanced observable functions like extenders, or manual subscriptions. You could still do those things, but since your model properties are being lazily created, you would have to modify the method with another way to access the lazily created values. This could be something like a callback with the key and observable value to bind subscriptions to.</p>

<figure class='code'><figcaption><span>Knockout Lazy-Model html </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html+lasso'><span class='line'>     <span class="c">&lt;!-- ko model: {value:&#39;name&#39;,target:model,onCreate:created} --&gt;</span>
</span><span class='line'>      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">required</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value:model.name, valueUpdate: &#39;keydown&#39;&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="c">&lt;!-- /ko --&gt;</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://gist.github.com/bringking/9459485">Here</a> is a gist of a working implementation, but feel free to modify and extend if you find it useful.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-09T16:40:00-07:00" pubdate data-updated="true">Mar 9<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/angularjs/'>AngularJS</a>, <a class='category' href='/blog/categories/knockoutjs/'>KnockoutJS</a>, <a class='category' href='/blog/categories/ngmodel/'>ngModel</a>


</div>
	
		<span class="comments"><a href="/blog/2014/03/09/an-ngmodel-binding-handler-for-knockoutjs/#disqus_thread">Comments</a></span>
	
</div></article>
<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Charles King

</footer>
	<script src="/javascripts/slash.js"></script>
Included file 'fancybox.html' not found in _includes directory <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'codinginthebasement';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://charlesbking.com/blog/2014/03/09/an-ngmodel-binding-handler-for-knockoutjs/';
        var disqus_url = 'http://charlesbking.com/blog/2014/03/09/an-ngmodel-binding-handler-for-knockoutjs/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-32494194-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>