<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: DRY | Coding in the basement]]></title>
  <link href="http://charlesbking.com/blog/categories/dry/atom.xml" rel="self"/>
  <link href="http://charlesbking.com/"/>
  <updated>2014-03-09T21:51:52-07:00</updated>
  <id>http://charlesbking.com/</id>
  <author>
    <name><![CDATA[Charles King]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Reusable UI Controls With KnockoutJS]]></title>
    <link href="http://charlesbking.com/blog/2014/01/18/reusable-ui-controls-with-knockoutjs/"/>
    <updated>2014-01-18T19:39:59-07:00</updated>
    <id>http://charlesbking.com/blog/2014/01/18/reusable-ui-controls-with-knockoutjs</id>
    <content type="html"><![CDATA[<p>When developing large applications, it&rsquo;s best practice to use some level of the <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a> principle, and attempt to create reusable modules, components, and code wherever possible. Unfortunately, adhering to this principle with KnockoutJS it not as straight-forward as it could be.</p>

<!-- more -->


<h2>The problem</h2>

<p>The problem.. well it&rsquo;s not really a problem, it&rsquo;s just the way KnockoutJS was designed. KnockoutJS is more of a library for doing <a href="http://en.wikipedia.org/wiki/Model_View_ViewModel">MVVM</a>, than a framework that has opinions on how you re-use your code. There are a few frameworks out there that attempt to solve this issue, and do it very well.</p>

<ul>
<li><a href="http://durandaljs.com/">Durandal</a> is a great framework that builds on Knockout to provide things like <a href="http://durandaljs.com/documentation/Creating-A-Module/">modules</a>, <a href="http://durandaljs.com/documentation/Creating-A-View/">views</a> and a router. It is really more comparable to AngularJS or Ember, than to vanilla Knockout.</li>
<li><a href="http://stoodder.github.io/falconjs/">Falcon.js</a> Falcon is a relative newcomer, and admittedly  I have not used it, but it introduces Objects, Models and Views to help give Knockout some structure.</li>
</ul>


<p>However, what if you are already invested in a large vanilla Knockout codebase and don&rsquo;t want to introduce a new framework? You can use some clever binding handlers.</p>

<h2>Reusable binding handlers</h2>

<p>Using Knockout&rsquo;s <a href="http://knockoutjs.com/documentation/custom-bindings.html">bindingHandlers</a> and in-line <a href="http://knockoutjs.com/documentation/template-binding.html">template</a> engine, you can generate reusable UI controls that are fully portable, and can be introduced into any viewmodel.</p>

<p>To demo this, lets put together a simple hierarchical tree-view, that can be given a set of JSON, display it and track selections. Start with the bindingHandler that is appropriately called <strong>treeView</strong>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>  <span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">treeView</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">//style element</span>
</span><span class='line'>      <span class="nx">element</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;ko-treeview-container&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>       <span class="c1">//let this handler control its descendants. </span>
</span><span class='line'>       <span class="k">return</span> <span class="p">{</span> <span class="nx">controlsDescendantBindings</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>In this block, we have the initialize function for the bindingHandler that will run when Knockout binds to the View. The key to making this bindingHandler reusable, is the return value. <strong>controlsDescendantBindings: true</strong> tells Knockout to stop the parent context from trying to bind against this elements children, giving our bindingHandler full control over its bound element. The Knockout <a href="http://knockoutjs.com/documentation/custom-bindings-controlling-descendant-bindings.html">documentation</a> goes over this in more detail. Also, I am adding a CSS class to the bound container at runtime, so it can be controlled with an included stylesheet.</p>

<p>Next lets add some options to the valueAccessor, to build the API that you will use to control the element.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>      <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">valueAccessor</span><span class="p">();</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;ko.bindingHandlers.treeView: No data to display&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//extend options with search</span>
</span><span class='line'>      <span class="nx">options</span><span class="p">.</span><span class="nx">search</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//set default data values</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">label</span><span class="p">)</span> <span class="nx">options</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">childNode</span><span class="p">)</span> <span class="nx">options</span><span class="p">.</span><span class="nx">childNode</span> <span class="o">=</span> <span class="s1">&#39;children&#39;</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>We get a reference to the valueAccessor() and add an observable <strong>options.search</strong> to allow the user to filter the view by keyword. Also, we allow the user to pass in the value of the <strong>label</strong> (this will serve as a unique id for the node) for each tree node, and the property <strong>childNode</strong> to specify the object property to search for child nodes. With this we have enough information to build the UI.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>    <span class="nx">createNodes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rootElement</span><span class="p">,</span> <span class="nx">options</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//Root node template containing a list of the top level nodes in the data set</span>
</span><span class='line'> <span class="kd">var</span> <span class="nx">rootTmpl</span> <span class="o">=</span> <span class="s1">&#39;&amp;lt;script id=&quot;ko-treeview-root-tmpl&quot;&amp;gt;&amp;lt;div class=&quot;navbar&quot;&amp;gt;&amp;lt;p class=&quot;brand&quot; data-bind=&quot;text:$data.title&quot;&amp;gt;Title&amp;lt;/p&amp;gt;&amp;lt;div class=&quot;container&quot;&amp;gt;&amp;lt;form class=&quot;navbar-form pull-right col-sm-4&quot;&amp;gt;&amp;lt;div class=&quot;input-append&quot;&amp;gt;&amp;lt;input class=&quot;span4&quot; type=&quot;text&quot; placeholder=&quot;Search&quot; data-bind=&quot;value:$data.search, valueUpdate: \&#39;afterkeydown\&#39;&quot;/&amp;gt;&amp;lt;span class=&quot;add-on&quot;&amp;gt;&amp;lt;i class=&quot;icon-search&quot;&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/form&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;ul class=&quot;ko-treeview-list&quot; data-bind=&quot;template:{foreach:$data.data,name:\&#39;ko-treeview-node-tmpl\&#39;}&quot;&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/script&amp;gt;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//the template to display each node, notice the recursive template binding with UL</span>
</span><span class='line'> <span class="kd">var</span> <span class="nx">nodeTmpl</span> <span class="o">=</span> <span class="s1">&#39;&amp;lt;script id=&quot;ko-treeview-node-tmpl&quot;&amp;gt;&amp;lt;li class=&quot;ko-treeview-listitem&quot;&amp;gt;&amp;lt;div data-bind=&quot;template:{name:\&#39;ko-treeview-item-tmpl\&#39;,data:$data}&quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;ul class=&quot;ko-treeview-list&quot; data-bind=&quot;template:{name:\&#39;ko-treeview-node-tmpl\&#39;,foreach:$data[$root.childNode]}&quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/script&amp;gt;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//the item inside the node, a checkbox and a label.</span>
</span><span class='line'> <span class="kd">var</span> <span class="nx">itemTmpl</span> <span class="o">=</span><span class="s1">&#39;&amp;lt;script id=&quot;ko-treeview-item-tmpl&quot;&amp;gt;&amp;lt;div data-bind=&quot;visible:$data[$root.label].indexOf($root.search()) &amp;gt; -1&quot;&amp;gt;&amp;lt;input type=&quot;checkbox&quot; class=&quot;ko-treeview-cb&quot; data-bind=&quot;checked: $root.selected, attr:{value:$data[$root.label], id:$data[$root.label]}&quot;  /&amp;gt;&amp;lt;label  class=&quot;ko-treeview-label&quot; data-bind=&quot;text:$data[$root.label], attr:{for:$data[$root.label]}&quot;&amp;gt;&amp;lt;/label&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/script&amp;gt;&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//append templates</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ko-treeview-root-tmpl&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">&#39;beforeend&#39;</span><span class="p">,</span> <span class="nx">rootTmpl</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ko-treeview-node-tmpl&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">&#39;beforeend&#39;</span><span class="p">,</span> <span class="nx">nodeTmpl</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ko-treeview-item-tmpl&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">&#39;beforeend&#39;</span><span class="p">,</span> <span class="nx">itemTmpl</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">//apply first binding</span>
</span><span class='line'>   <span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindingsToNode</span><span class="p">(</span><span class="nx">rootElement</span><span class="p">,{</span><span class="nx">template</span><span class="o">:</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;ko-treeview-root-tmpl&quot;</span><span class="p">}},</span><span class="nx">options</span><span class="p">);</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>There is a lot that I just added there, but the heavy lifting of the <strong>createNodes</strong> function is all done by Knockout&rsquo;s template engine. In this case, the templates are the outer list, each node, and the items in the node. The most important piece for the treeView; is the node template. The node template is recursively generating any child items the node contains.  Finally, we need to apply the template binding to the rootElement using <strong>ko.applyBindingsToNode.</strong> ko.applyBindingsToNode allows us to specify bindings to an element, and the context for those bindings.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>    <span class="c1">//create the tree</span>
</span><span class='line'>     <span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">treeView</span><span class="p">.</span><span class="nx">createNodes</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>
</span><span class='line'>     <span class="nx">valueAccessor</span><span class="p">().</span><span class="nx">data</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">treeView</span><span class="p">.</span><span class="nx">createNodes</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Finally, we can finish up by running the <strong>createNodes</strong> function on init, and subscribing to the data set to refresh the treeView if the data changes. Let&rsquo;s see the final product.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">treeView</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">createNodes</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rootElement</span><span class="p">,</span> <span class="nx">options</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//Root node template containing a list of the top level nodes in the data set</span>
</span><span class='line'> <span class="kd">var</span> <span class="nx">rootTmpl</span> <span class="o">=</span> <span class="s1">&#39;&amp;lt;script id=&quot;ko-treeview-root-tmpl&quot;&amp;gt;&amp;lt;div class=&quot;navbar&quot;&amp;gt;&amp;lt;p class=&quot;brand&quot; data-bind=&quot;text:$data.title&quot;&amp;gt;Title&amp;lt;/p&amp;gt;&amp;lt;div class=&quot;container&quot;&amp;gt;&amp;lt;form class=&quot;navbar-form pull-right col-sm-4&quot;&amp;gt;&amp;lt;div class=&quot;input-append&quot;&amp;gt;&amp;lt;input class=&quot;span4&quot; type=&quot;text&quot; placeholder=&quot;Search&quot; data-bind=&quot;value:$data.search, valueUpdate: \&#39;afterkeydown\&#39;&quot;/&amp;gt;&amp;lt;span class=&quot;add-on&quot;&amp;gt;&amp;lt;i class=&quot;icon-search&quot;&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/form&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;ul class=&quot;ko-treeview-list&quot; data-bind=&quot;template:{foreach:$data.data,name:\&#39;ko-treeview-node-tmpl\&#39;}&quot;&amp;gt;&amp;lt;/ul&amp;gt;&amp;lt;/script&amp;gt;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//the template to display each node, notice the recursive template binding with UL</span>
</span><span class='line'> <span class="kd">var</span> <span class="nx">nodeTmpl</span> <span class="o">=</span> <span class="s1">&#39;&amp;lt;script id=&quot;ko-treeview-node-tmpl&quot;&amp;gt;&amp;lt;li class=&quot;ko-treeview-listitem&quot;&amp;gt;&amp;lt;div data-bind=&quot;template:{name:\&#39;ko-treeview-item-tmpl\&#39;,data:$data}&quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;ul class=&quot;ko-treeview-list&quot; data-bind=&quot;template:{name:\&#39;ko-treeview-node-tmpl\&#39;,foreach:$data[$root.childNode]}&quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;/script&amp;gt;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//the item inside the node, a checkbox and a label.</span>
</span><span class='line'> <span class="kd">var</span> <span class="nx">itemTmpl</span> <span class="o">=</span><span class="s1">&#39;&amp;lt;script id=&quot;ko-treeview-item-tmpl&quot;&amp;gt;&amp;lt;div data-bind=&quot;visible:$data[$root.label].indexOf($root.search()) &amp;gt; -1&quot;&amp;gt;&amp;lt;input type=&quot;checkbox&quot; class=&quot;ko-treeview-cb&quot; data-bind=&quot;checked: $root.selected, attr:{value:$data[$root.label], id:$data[$root.label]}&quot;  /&amp;gt;&amp;lt;label  class=&quot;ko-treeview-label&quot; data-bind=&quot;text:$data[$root.label], attr:{for:$data[$root.label]}&quot;&amp;gt;&amp;lt;/label&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/script&amp;gt;&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//append templates</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ko-treeview-root-tmpl&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">&#39;beforeend&#39;</span><span class="p">,</span> <span class="nx">rootTmpl</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ko-treeview-node-tmpl&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">&#39;beforeend&#39;</span><span class="p">,</span> <span class="nx">nodeTmpl</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ko-treeview-item-tmpl&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">&#39;beforeend&#39;</span><span class="p">,</span> <span class="nx">itemTmpl</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">//apply first binding</span>
</span><span class='line'>   <span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindingsToNode</span><span class="p">(</span><span class="nx">rootElement</span><span class="p">,{</span><span class="nx">template</span><span class="o">:</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;ko-treeview-root-tmpl&quot;</span><span class="p">}},</span><span class="nx">options</span><span class="p">);</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="p">},</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">//style element</span>
</span><span class='line'>      <span class="nx">element</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;ko-treeview-container&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">valueAccessor</span><span class="p">();</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;ko.bindingHandlers.treeView: No data to display&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//extend options with search</span>
</span><span class='line'>      <span class="nx">options</span><span class="p">.</span><span class="nx">search</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//set default data values</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">label</span><span class="p">)</span> <span class="nx">options</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">childNode</span><span class="p">)</span> <span class="nx">options</span><span class="p">.</span><span class="nx">childNode</span> <span class="o">=</span> <span class="s1">&#39;children&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//create the tree</span>
</span><span class='line'>     <span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">treeView</span><span class="p">.</span><span class="nx">createNodes</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>
</span><span class='line'>     <span class="nx">valueAccessor</span><span class="p">().</span><span class="nx">data</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">treeView</span><span class="p">.</span><span class="nx">createNodes</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//let this handler control its descendants. </span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span> <span class="nx">controlsDescendantBindings</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now that we made this bindingHandler reusable, it can be bound to a container element, passed the appropriate data, and it will do the rest (except styling, but that can be addressed in a few different ways). You would use this handler like-</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;div</span> <span class="na">data-bind=</span><span class="s">&quot;treeView:{selected:selectedNodes, data:data}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">vm</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">selectedNodes</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observableArray</span><span class="p">([]);</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observableArray</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="p">{</span>
</span><span class='line'> <span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 1-1&quot;</span><span class="p">,</span><span class="nx">children</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>      <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 1-1-1&quot;</span><span class="p">,</span><span class="nx">children</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>        <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 1-1-1-1&quot;</span><span class="p">}</span>
</span><span class='line'>      <span class="p">]}</span>
</span><span class='line'>    <span class="p">]},</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 1-2&quot;</span><span class="p">},</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'> <span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 2&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 2-1&quot;</span><span class="p">,</span><span class="nx">children</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>      <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 2-1-1&quot;</span><span class="p">}</span>
</span><span class='line'>    <span class="p">]},</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;Level 2-2&quot;</span><span class="p">},</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="p">]);</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myVM</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">vm</span><span class="p">();</span>  <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindings</span><span class="p">(</span><span class="nx">myVM</span><span class="p">);</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Here is a working <a href="http://jsbin.com/Awipoku/14/edit">JSBin</a> of the finished result. What makes this pattern so nice, is it not only removes the handler behavior from the VM, but also the handlers views and templates from the VM. This results in a nicely modular UI component.</p>
]]></content>
  </entry>
  
</feed>
